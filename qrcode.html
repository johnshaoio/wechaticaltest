<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="./js/html5-qrcode.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


</head>
<body>

	<input type="button" value="Resume" onclick="resumeScan()">

<h1>This isss ass 20210129 aaaaaaaaaaa</h1>

<div id="scanarea" width="600px"></div>

<div id="reader" width="600px"></div>

</body>

<script>

const axios = require('axios');

// Make a request for a user with a given ID
axios.get('/wechaticaltest/data/a.json')
  .then(function (response) {
    // handle success
    alert(response.data);
  })
  .catch(function (error) {
    // handle error
    console.log(error);
  })
  .then(function () {
    // always executed
  });

function onScanSuccess(qrMessage) {
	// handle the scanned code as you like

	if(qrMessage.includes('gov.mo')){
		window.location.href = qrMessage;
	}else{
		alert(`QR matched = ${qrMessage}`);
	}

}

function onScanFailure(error) {
	// handle scan failure, usually better to ignore and keep scanning
	console.warn(`QR error = ${error}`);
}

// let html5QrcodeScanner = new Html5QrcodeScanner(
// 	"reader", { fps: 10, qrbox: 250 }, /* verbose= */ true);
// html5QrcodeScanner.render(onScanSuccess, onScanFailure);


var scanner = new Html5Qrcode("scanarea");
var qrCodeSuccessCallback = message => { 
	$('body').prepend(message); 
	scanner.stop();
};

var config = { fps: 10, qrbox: 250 };

Html5Qrcode.getCameras().then(devices => {
  /**
   * devices would be an array of objects of type:
   * { id: "id", label: "label" }
   */
  $('body').append('aaa');

	devices.forEach(device => {
		$('body').prepend(device.id+'<br />');
		$('body').prepend(device.label+'<br />');
	});

  if (devices && devices.length) {
    var cameraId = devices[0].id;
    // .. use this to start scanning.
	//$('body').append(cameraId);
  }
  $('body').append('bbbb');
  scanner.start({ facingMode: { exact: "environment"} }, config, qrCodeSuccessCallback);
  $('body').append('cccc');

}).catch(err => {
	alert(err);
});

function resumeScan(){
	scanner.start({ facingMode: { exact: "environment"} }, config, qrCodeSuccessCallback);
};

// If you want to prefer back camera

</script>

</html>